@page "/cookbook/recipes/add"
@using Web.Shared.Models
@inherits MvvmConponentBase<AddRecipePageViewModel>
@rendermode InteractiveAuto

<div id="add-recipe-container" class="container">
    <PageHeader Title="Neues Rezept" SubTitle="Sende ein neues Rezept ein." />
    <div class="container mt-3">
        <div class="p-2">
            <!-- Basic Recipe Data -->
            <div class="row">
                <div class="col-md-6 flex-column">
                    <div class="row mt-4">
                        <div class="container d-flex justify-content-center align-items-center h-100">
                            <div class="col-md-12 d-flex justify-content-center mt-">
                                <ImageSelector Id="recipe-img"
                                               ImgSource="@ViewModel.ImgSrc"
                                               Label="Bild"
                                               OnChange="@ViewModel.HandleImageChanged" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="row mt-4">
                            <Dropdown Id="recipe-category"
                                      Validate="true"
                                      ErrorMsg="Keine Kategorie gewählt!"
                                      DefaultItem="Wähle eine Kategorie"
                                      SelectedValue="ViewModel.ImportModel.RecipeCategory.CategoryId?? 0"
                                      Items="@ViewModel.RecipeCategoryItems"
                                      OnChange="@ViewModel.HandleRecipeCategoryChanged" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="row mt-4">
                            <AutoComplete Id="recipe-title"
                                          Validate="true"
                                          ErrorMsg="Kein Rezeptname eingegeben!"
                                          Placeholder="Rezeptname..."
                                          TextValue="@ViewModel.ImportModel.Title"
                                          Items="@ViewModel.RecipeNames"
                                          OnChange="@ViewModel.HandleRecipeTitleChanged" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="row mt-4">
                            <TextField Id="recipe-short-description"
                                       Validate="true"
                                       ErrorMsg="Keine Rezeptbeschreibung eingegeben"
                                       Placeholder="Rezeptbeschreibung..."
                                       TextValue="@ViewModel.ImportModel.ShortDescription"
                                       OnChange="@ViewModel.HandleRecipeShortDescriptionChanged" />
                        </div>

                    </div>
                </div>
            </div>
            <!-- Ingredient Data -->
            <div class="row">
                <div class="col-12 p-2">
                    <div class="col-12 d-flex justify-content-end px-4">
                        <button type="button" class="btn btn-outline-primary" @onclick="@ViewModel.ToggleIngredientDialogOpen">Zutaten</button>
                    </div>
                    <div class="container d-flex">
                        <div class="d-flex flex-wrap justify-content-start gap-2 mt-5">
                            @for (var index = 0; index < ViewModel.ImportModel.Ingredients.Count(); index++)
                            {
                                <IngredientChip Amount="@ViewModel.ImportModel.Ingredients[index].Amount"
                                                Unit="@ViewModel.ImportModel.Ingredients[index].Unit"
                                                Name="@ViewModel.ImportModel.Ingredients[index].Name"
                                                AdditionalClasses="chip-blue"
                                                Index="@index"
                                                OnClick="@ViewModel.HandleRemoveIngredient" />
                            }
                        </div>
                    </div>
                </div>
            </div>
            <!-- Recipe description Data -->
            <div class="row mt-2">
                <div class="col-12">
                    <textarea class="form-control"
                              type="text"
                              placeholder="Zubereitungsinformationen"
                              rows="8"
                              @oninput="ViewModel.HandleDescriptionChanged"
                              value="@ViewModel.ImportModel.Description" />
                </div>
            </div>
            <!-- Buttons -->
            <div class="row mt-5">
                <div class="col-12 d-flex justify-content-end gap-2 px-4">
                    <a href="/cookbook" class="btn btn-outline-primary">Abbrechen</a>
                    <button id="save-recipe-button" disabled="@ViewModel.SaveDisabled" class="btn btn-outline-primary" @onclick="@ViewModel.HandleSaveRecipe">Speichern</button>
                </div>
            </div>
        </div>
    </div>

    @if (ViewModel.IsLoading == true)
    {
        <LoadingIndicator Label="Loading" />

    }

    @if (ViewModel.IngredientDialogOpen)
    {
        <AddIngredientDialog DialogTitle="Zutaten hinzufügen"
                             IngredientCategories="@ViewModel.IngredientCategoryItems"
                             Units="@ViewModel.UnitItems"
                             OnAddIngredient="@ViewModel.HandleAddIngredient"
                             OnClose="@ViewModel.HandleCloseDialog" />
    }
</div>

